# V3 Dev Agent - 연속 실행 통계 모니터링

쿠팡 키워드 순위를 지속적으로 체크하며 실시간 통계를 제공하는 개발용 에이전트입니다.

## 🚀 빠른 시작

```bash
# 실행
./run.sh

# 중단: Ctrl+C
```

## 📊 주요 기능

### 실시간 통계 모니터링
- **누적 통계**: 성공, 실패, 차단, 키워드 없음 건수
- **성공률**: 실시간 성공률 계산
- **경과 시간**: 세션 시작 후 경과 시간
- **자동 간격 조정**: 상태에 따라 대기 시간 자동 조정

### 대기 시간 정책
- **성공 시**: 5초 대기
- **키워드 없음**: 60초 시작, 최대 605초까지 증가
- **실패/차단**: 60초 시작, 최대 600초까지 증가

## 🔧 환경 설정

### 필수 환경 변수
```bash
# .env 파일에 설정
HUB_API_URL=http://localhost:3331  # Hub API 주소
BROWSER=chrome                      # 브라우저 (chrome/firefox)
BATCH_MAX_PAGES=5                   # 최대 검색 페이지 수
LOG_LEVEL=info                      # 로그 레벨
```

### 브라우저 설정
- **Chrome** (기본값): 안정적이고 빠른 실행
- **Firefox**: 차단 우회에 유리할 수 있음

## 📁 디렉토리 구조

```
dev_agent/
├── run.sh                       # 메인 실행 스크립트
├── check.js                     # API 체크 스크립트
├── package.json                 # 의존성 관리
├── .env                         # 환경 설정
├── logs/                        # 실행 로그
│   └── batch-check-api-*.log
├── data/                        # 브라우저 데이터
├── _backup/                     # 백업 파일들
└── _archived/                   # 이전 버전 파일들
```

## 📈 통계 화면 예시

```
📊 ============== 세션 누적 통계 ==============
🕐 시작 시간: 2025-07-29 14:30:00
⏱️  경과 시간: 01:23:45
🔄 전체 실행: 120회

✅ 성공: 95
❌ 실패: 5
🚫 차단: 2
📭 키워드 없음: 18

📈 성공률: 92.2%
🔍 전체 시도: 102
=============================================
```

## 🛠️ 문제 해결

### 차단 발생 시
- 자동으로 대기 시간이 증가하여 재시도
- Firefox 브라우저로 변경 시도
- 프록시 설정 검토

### 키워드 없음이 계속될 때
- Hub API의 키워드 큐 확인
- PostgreSQL v3_keyword_list 테이블 확인
- 동기화 스크립트 실행 상태 확인

### 로그 확인
```bash
# 실시간 로그
tail -f logs/batch-check-api-*.log

# 오늘 로그 보기
cat logs/batch-check-api-$(date +%Y-%m-%d).log
```

## 🔗 관련 시스템

- **Hub API**: 키워드 제공 및 결과 저장
- **PostgreSQL**: v3_keyword_ranking_checks 테이블
- **MySQL 동기화**: 10분마다 결과 동기화

## ⚠️ 주의사항

- GUI 모드로만 실행 (headless: false)
- 한 번에 1개 키워드만 처리
- 차단 감지 시 자동으로 긴 대기 시간 적용
- 로그 파일은 일별로 자동 생성

---

개발 환경: Node.js 16+, Playwright, Winston